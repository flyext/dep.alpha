<project xmlns:ivy="antlib:org.apache.ivy.ant" name="common-build-infrastructure">

    <property file="${build-infrastructure.dir}/common.properties" />

    <target name="resolve" description="Retrieve dependencies with ivy">
        <ivy:settings/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact].[ext]" />
    </target>

    <target name="clean" description="Removes all generated artifacts">
        <delete dir="target"/>
    </target>

    <target name="build" depends="resolve" description="Build this module">
        <mkdir dir="${artifact.dir}"/>
        <jar destfile="${artifact.dir}/${ivy.module}.jar" />
    </target>

    <target name="publish-local" depends="build" description="Publish module to local repository">
        <ivy:buildnumber organisation="${ivy.organisation}" module="${ivy.module}" revision="${module.version}" branch="${branch.name}"/>
        <ivy:publish resolver="local" pubrevision="${ivy.new.revision}" forcedeliver="true" pubbranch="${branch.name}">
            <artifacts pattern="${artifact.dir}/[artifact].[ext]" />
        </ivy:publish>
    </target>

</project>